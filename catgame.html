<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Игра с котиком</title>
    <link href="https://fonts.googleapis.com/css2?family=Comic+Neue:wght@700&display=swap" rel="stylesheet">
    <style>
        body {
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            width: 100vw;
            background: linear-gradient(135deg, #ff9a9e, #fad0c4, #a1c4fd, #c2e9fb);
            font-family: 'Comic Neue', cursive;
            overflow: hidden;
            touch-action: manipulation; /* Отключает масштабирование при двойном касании */
        }
        #game-wrapper {
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
            height: 100%;
        }
        #game-container {
            position: relative;
            width: 100vw;
            height: calc(100vh - 100px); /* Оставляем место для кнопок */
            background: linear-gradient(135deg, #d4fc79, #96e6a1);
            border-radius: 0; /* Убираем скругления для полного экрана */
            box-shadow: 0 15px 40px rgba(0,0,0,0.3);
            overflow: hidden;
            border: none;
        }
        #cat {
            position: absolute;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            transition: transform 0.5s ease-out;
            z-index: 10;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        .platform {
            position: absolute;
            height: 15px;
            background: linear-gradient(45deg, #ff6b6b, #ff8e53);
            border-radius: 8px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.2);
            z-index: 5;
            animation: bounce 2s infinite;
        }
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-5px); }
            60% { transform: translateY(-3px); }
        }
        .bonus {
            position: absolute;
            z-index: 15;
            transition: transform 0.3s ease;
        }
        .bonus:hover {
            transform: scale(1.2);
        }
        .heart-bonus {
            width: 20px;
            height: 20px;
            background: radial-gradient(#ff69b4, #ff1493);
            clip-path: polygon(50% 0%, 61% 35%, 98% 35%, 68% 57%, 79% 91%, 50% 70%, 21% 91%, 32% 57%, 2% 35%, 39% 35%);
            animation: float 1.5s infinite;
        }
        .food-bonus {
            width: 30px;
            height: 20px;
            background: #8b4513;
            border-radius: 5px;
            animation: float 1.5s infinite;
        }
        @keyframes float {
            0% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
            100% { transform: translateY(0); }
        }
        #dog {
            position: absolute;
            width: 40px;
            height: 30px;
            background: linear-gradient(45deg, #8b4513, #a0522d);
            border-radius: 8px;
            z-index: 10;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            animation: wag 0.5s infinite;
        }
        @keyframes wag {
            0% { transform: rotate(0deg); }
            25% { transform: rotate(5deg); }
            75% { transform: rotate(-5deg); }
            100% { transform: rotate(0deg); }
        }
        #score {
            position: absolute;
            top: 20px;
            left: 20px;
            color: #fff;
            font-weight: 700;
            font-size: 28px;
            padding: 8px 20px;
            border-radius: 25px;
            z-index: 20;
            animation: glow 2s infinite;
        }
        #steps {
            position: absolute;
            top: 70px;
            left: 20px;
            color: #fff;
            font-weight: 700;
            font-size: 22px;
            padding: 8px 20px;
            border-radius: 25px;
            z-index: 20;
            animation: glow 2s infinite;
        }
        @keyframes glow {
            0% { box-shadow: 0 0 5px rgba(255,255,255,0.5); }
            50% { box-shadow: 0 0 15px rgba(255,255,255,0.8); }
            100% { box-shadow: 0 0 5px rgba(255,255,255,0.5); }
        }
        #lives {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 8px;
            z-index: 20;
        }
        .heart {
            width: 25px;
            height: 25px;
            background: radial-gradient(circle, #ff69b4, #ff1493);
            clip-path: polygon(50% 0%, 61% 35%, 98% 35%, 68% 57%, 79% 91%, 50% 70%, 21% 91%, 32% 57%, 2% 35%, 39% 35%);
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            animation: heartbeat 1s infinite;
        }
        @keyframes heartbeat {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        #menu, #game-over, #win-screen {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            color: #fff;
            text-shadow: 2px 2px 6px rgba(0,0,0,0.5);
            background: rgba(255,255,255,0.2);
            padding: 40px;
            border-radius: 40px;
            backdrop-filter: blur(15px);
            z-index: 25;
            animation: pop 0.5s ease-in-out;
            width: 80%;
            max-width: 400px;
        }
        #menu button {
            margin: 15px;
            width: 100%;
        }
        @keyframes pop {
            0% { transform: translate(-50%, -50%) scale(0.8); opacity: 0; }
            100% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
        }
        #game-over {
            background: rgba(255, 105, 97, 0.9);
        }
        #win-screen {
            background: rgba(255, 182, 193, 0.9);
        }
        .controls {
            position: fixed;
            bottom: 0;
            width: 100vw;
            height: 100px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            box-sizing: border-box;
            z-index: 30;
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
        }
        .left-controls {
            display: flex;
            gap: 20px;
        }
        button {
            padding: 15px 30px;
            border: none;
            border-radius: 30px;
            background: linear-gradient(45deg, #ff6b6b, #ff8e53);
            color: #fff;
            font-family: 'Comic Neue', cursive;
            font-weight: 700;
            font-size: 20px;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            touch-action: manipulation; /* Убирает нежелательные эффекты при касании */
            -webkit-tap-highlight-color: transparent; /* Убирает подсветку при нажатии */
        }
        button:active {
            transform: scale(0.95);
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }
        button:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.3);
        }
        .blink { animation: blink 0.5s infinite; }
        @keyframes blink { 50% { opacity: 0; } }
        .score-pop {
            position: absolute;
            font-weight: 700;
            font-size: 24px;
            z-index: 20;
            animation: scoreFade 1s forwards;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }
        .heart-pop { color: #ff1493; }
        .food-pop { color: #8b4513; }
        @keyframes scoreFade {
            0% { opacity: 1; transform: translateY(0) scale(1); }
            100% { opacity: 0; transform: translateY(-30px) scale(1.2); }
        }
    </style>
</head>
<body>
    <div id="game-wrapper">
        <div id="game-container">
            <div id="score">Очки: 0</div>
            <div id="steps">Ступень: 1</div>
            <div id="lives"></div>
            <div id="cat"></div>
            <div id="menu">
                <h2>Выбери котика</h2>
                <p>Цель: Получи 1000 очков</p>
                <button onclick="startGame('pushok')">Пушок</button>
                <button onclick="startGame('fenya')">Феня</button>
            </div>
            <div id="game-over" style="display: none;">
                <h2>Игра окончена!</h2>
                <p id="final-score">Очки: 0</p>
                <p id="final-steps">Ступеней: 0</p>
                <button onclick="restartGame()">Играть заново</button>
            </div>
            <div id="win-screen" style="display: none;">
                <h2>Поздравляю с 8 Марта!</h2>
                <button onclick="continueGame()">Продолжить игру</button>
            </div>
        </div>
        <div class="controls">
            <div class="left-controls">
                <button id="left-btn" ontouchstart="moveLeft(true)" ontouchend="moveLeft(false)">←</button>
                <button id="right-btn" ontouchstart="moveRight(true)" ontouchend="moveRight(false)">→</button>
            </div>
            <button id="jump-btn" ontouchstart="jump()">Прыжок</button>
        </div>
    </div>

    <script>
        const gameContainer = document.getElementById('game-container');
        const cat = document.getElementById('cat');
        const scoreDisplay = document.getElementById('score');
        const stepsDisplay = document.getElementById('steps');
        const livesDisplay = document.getElementById('lives');
        const menu = document.getElementById('menu');
        const gameOver = document.getElementById('game-over');
        const winScreen = document.getElementById('win-screen');
        const finalScore = document.getElementById('final-score');
        const finalSteps = document.getElementById('final-steps');

        let catX = window.innerWidth / 2 - 20, catY = window.innerHeight - 140, velocityY = 0, isJumping = false;
        let score = 0, lives = 1, platforms = [], bonuses = [], dog = null;
        let movingLeft = false, movingRight = false;
        let selectedCat = null, worldOffset = 0;
        let gameActive = true, visitedPlatforms = new Set();
        let platformCount = 0;
        let currentPlatform = null;
        let steps = 0;
        let hasWon = false;

        function startGame(catType) {
            selectedCat = catType;
            cat.style.background = catType === 'pushok' ? 'radial-gradient(#fff, #ccc, #000)' : 'radial-gradient(#ff8c00, #ffa500)';
            menu.style.display = 'none';
            initGame();
            console.log(`Котик выбран: ${catType === 'pushok' ? 'Пушок' : 'Феня'}`);
            spawnDogRandomly();
        }

        function initGame() {
            platformCount = 0;
            visitedPlatforms.clear();
            platforms.forEach(p => p.element.remove());
            bonuses.forEach(b => b.element.remove());
            bonuses = [];
            platforms = [];
            generateInitialPlatforms();
            
            catX = window.innerWidth / 2 - 20;
            catY = window.innerHeight - 140;
            currentPlatform = platforms[0];
            cat.style.left = `${catX}px`;
            cat.style.top = `${catY}px`;
            worldOffset = 0;
            lives = 1;
            score = 0;
            steps = 0;
            gameActive = true;
            isJumping = false;
            velocityY = 0;
            hasWon = false;
            updateScore();
            updateSteps();
            updateLives();
            gameLoop();
        }

        function generateInitialPlatforms() {
            for (let i = 0; i < 10; i++) {
                addNewPlatform();
            }
        }

        function addNewPlatform() {
            platformCount++;
            const x = Math.floor(Math.random() * (window.innerWidth - 100)) + 50;
            const y = platforms.length ? platforms[platforms.length - 1].y - 150 : window.innerHeight - 100;
            const isSmall = platformCount % 10 === 0 && Math.random() > 0.5;
            let width = isSmall ? 50 : 100;
            if (platformCount > 40) {
                width = Math.max(10, 100 - (platformCount - 40) * 2);
            }
            const platform = document.createElement('div');
            platform.className = `platform`;
            platform.style.left = `${x}px`;
            platform.style.top = `${y}px`;
            platform.style.width = `${width}px`;
            platform.dataset.count = platformCount;
            gameContainer.appendChild(platform);
            const platformObj = { 
                x, 
                y, 
                element: platform, 
                width: width, 
                id: Date.now() + platformCount, 
                count: platformCount,
                speed: platformCount >= 20 ? (Math.random() > 0.5 ? 2 : -2) : 0
            };
            platforms.push(platformObj);

            if (platformCount % 20 === 0) {
                addBonus('heart', platformObj);
            } else if (platformCount % 8 === 0) {
                addBonus('food', platformObj);
            }
        }

        function addBonus(type, platform) {
            const bonus = {
                x: platform.x + platform.width / 2 - (type === 'food' ? 15 : 10),
                y: platform.y - 25,
                type: type,
                element: document.createElement('div'),
                parentPlatform: platform
            };
            bonus.element.className = `bonus ${type === 'heart' ? 'heart-bonus' : 'food-bonus'}`;
            bonus.element.style.left = `${bonus.x}px`;
            bonus.element.style.top = `${bonus.y}px`;
            gameContainer.appendChild(bonus.element);
            bonuses.push(bonus);
            console.log(`Бонус появился: ${type === 'heart' ? 'сердце' : 'еда'} на платформе ${platformCount}, x: ${bonus.x}, y: ${bonus.y}`);
        }

        function gameLoop() {
            if (!gameActive) return;

            updatePlatforms();

            if (currentPlatform && currentPlatform.count >= 20 && !isJumping) {
                catX += currentPlatform.speed;
                catX = Math.max(0, Math.min(window.innerWidth - 40, catX));
            }

            if (movingLeft) catX -= 5;
            if (movingRight) catX += 5;

            catX = Math.max(0, Math.min(window.innerWidth - 40, catX));

            if (isJumping) {
                catY += velocityY;
                velocityY += 0.5;
            }

            const onPlatform = platforms.find(p => 
                catY + 40 >= p.y && 
                catY + 40 <= p.y + 15 && 
                catX + 40 > p.x && 
                catX < p.x + p.width
            );

            if (onPlatform && velocityY >= 0) {
                catY = onPlatform.y - 40;
                isJumping = false;
                velocityY = 0;
                currentPlatform = onPlatform;
            } else if (currentPlatform && !isJumping) {
                if (catX < currentPlatform.x || catX + 40 > currentPlatform.x + currentPlatform.width) {
                    isJumping = true; // Кот падает, если вышел за границы без прыжка
                }
            } else if (catY >= window.innerHeight) {
                if (lives > 0) {
                    lives--;
                    catY = currentPlatform ? currentPlatform.y - 40 : platforms[0].y - 40;
                    catX = currentPlatform ? currentPlatform.x + currentPlatform.width / 2 - 20 : platforms[0].x + platforms[0].width / 2 - 20;
                    isJumping = false;
                    velocityY = 0;
                    cat.style.transform = 'rotate(0deg)';
                    cat.classList.add('blink');
                    setTimeout(() => cat.classList.remove('blink'), 2000);
                    updateLives();
                    console.log(`Жизнь потеряна, возвращён на платформу на высоте ${catY + 40}`);
                    if (!currentPlatform) currentPlatform = platforms[0];
                    if (lives <= 0) return endGame();
                }
            }

            adjustWorld();
            cat.style.left = `${catX}px`;
            cat.style.top = `${catY}px`;
            checkCollisions();

            if (score >= 1000 && !hasWon) {
                gameActive = false;
                winScreen.style.display = 'block';
                hasWon = true;
            }

            if (dog) updateDog();
            requestAnimationFrame(gameLoop);
        }

        function jump() {
            if (!gameActive || isJumping) return;
            const onPlatform = platforms.some(p => Math.abs(catY - (p.y - 40)) < 5);
            if (onPlatform) {
                isJumping = true;
                velocityY = -15;
                cat.style.transform = 'rotate(360deg)';
                console.log('Прыжок начался');
            }
        }

        function moveLeft(state) {
            if (!gameActive) return;
            movingLeft = state;
            console.log(`Движение влево: ${state ? 'начато' : 'остановлено'}`);
        }

        function moveRight(state) {
            if (!gameActive) return;
            movingRight = state;
            console.log(`Движение вправо: ${state ? 'начато' : 'остановлено'}`);
        }

        function updatePlatforms() {
            platforms.forEach(p => {
                if (p.count >= 20) {
                    p.x += p.speed;
                    if (p.x <= 0) p.speed = 2;
                    if (p.x >= window.innerWidth - p.width) p.speed = -2;
                    p.element.style.left = `${p.x}px`;
                }
            });

            bonuses.forEach(b => {
                if (b.parentPlatform.count >= 20) {
                    b.x = b.parentPlatform.x + b.parentPlatform.width / 2 - (b.type === 'food' ? 15 : 10);
                    b.element.style.left = `${b.x}px`;
                }
            });
        }

        function adjustWorld() {
            if (catY < 300) {
                worldOffset = 300 - catY;
                catY = 300;
                platforms.forEach(p => {
                    p.y += worldOffset;
                    p.element.style.top = `${p.y}px`;
                });
                bonuses.forEach(b => {
                    b.y += worldOffset;
                    b.element.style.top = `${b.y}px`;
                });
                if (dog) {
                    dog.y += worldOffset;
                    dog.element.style.top = `${dog.y}px`;
                }
                if (platforms[0].y > window.innerHeight) {
                    platforms.shift().element.remove();
                    addNewPlatform();
                }
                worldOffset = 0;
            }
        }

        function checkCollisions() {
            platforms.forEach(p => {
                if (
                    catY + 40 >= p.y && 
                    catY + 40 <= p.y + 15 && 
                    catX + 40 > p.x && 
                    catX < p.x + p.width && 
                    velocityY >= 0
                ) {
                    catY = p.y - 40;
                    isJumping = false;
                    velocityY = 0;
                    cat.style.transform = 'rotate(0deg)';
                    if (!visitedPlatforms.has(p.id)) {
                        visitedPlatforms.add(p.id);
                        animateScore(score, score + 10);
                        steps++;
                        updateSteps();
                    }
                    currentPlatform = p;
                }
            });

            bonuses.forEach((b, index) => {
                const bonusWidth = b.type === 'food' ? 30 : 20;
                if (
                    catX + 40 > b.x && 
                    catX < b.x + bonusWidth && 
                    catY + 40 > b.y && 
                    catY < b.y + 20
                ) {
                    if (b.type === 'heart') {
                        if (lives < 5) {
                            lives++;
                            updateLives();
                            console.log(`Собрано сердце, жизней: ${lives}`);
                        } else {
                            animateScore(score, score + 100);
                            showScorePopup('+100', 'heart-pop');
                            console.log(`Собрано сердце, +100 очков, очки: ${score}`);
                        }
                    } else if (b.type === 'food') {
                        animateScore(score, score + 50);
                        showScorePopup('+50', 'food-pop');
                        console.log(`Собрана еда, +50 очков, очки: ${score}`);
                    }
                    b.element.remove();
                    bonuses.splice(index, 1);
                }
            });
        }

        function animateScore(start, end) {
            let current = start;
            const increment = (end - start) / 20;
            const duration = 500;
            const stepTime = duration / 20;

            function step() {
                current += increment;
                if ((increment > 0 && current >= end) || (increment < 0 && current <= end)) {
                    score = end;
                    scoreDisplay.textContent = `Очки: ${Math.round(score)}`;
                } else {
                    scoreDisplay.textContent = `Очки: ${Math.round(current)}`;
                    setTimeout(step, stepTime);
                }
            }

            step();
            score = end;
        }

        function showScorePopup(text, type) {
            const popup = document.createElement('div');
            popup.className = `score-pop ${type}`;
            popup.textContent = text;
            popup.style.left = `${catX + 20}px`;
            popup.style.top = `${catY - 20}px`;
            gameContainer.appendChild(popup);
            setTimeout(() => popup.remove(), 1000);
        }

        function spawnDogRandomly() {
            if (!gameActive) return;
            setTimeout(() => {
                if (!dog && gameActive) spawnDog();
                spawnDogRandomly();
            }, Math.random() * 15000 + 15000);
        }

        function spawnDog() {
            dog = {
                x: -40,
                y: currentPlatform ? currentPlatform.y - 30 : window.innerHeight - 100,
                element: document.createElement('div')
            };
            dog.element.id = 'dog';
            dog.element.style.left = `${dog.x}px`;
            dog.element.style.top = `${dog.y}px`;
            gameContainer.appendChild(dog.element);
        }

        function updateDog() {
            dog.x += 5;
            dog.element.style.left = `${dog.x}px`;
            if (dog.x > window.innerWidth) {
                dog.element.remove();
                dog = null;
            } else if (
                catX + 40 > dog.x && 
                catX < dog.x + 40 && 
                catY + 40 > dog.y && 
                catY < dog.y + 30
            ) {
                lives = 0;
                updateLives();
                endGame();
            }
        }

        function updateScore() {
            scoreDisplay.textContent = `Очки: ${score}`;
            scoreDisplay.style.transform = 'scale(1.2)';
            setTimeout(() => scoreDisplay.style.transform = 'scale(1)', 200);
        }

        function updateSteps() {
            stepsDisplay.textContent = `Ступень: ${steps}`;
        }

        function updateLives() {
            livesDisplay.innerHTML = '';
            for (let i = 0; i < lives; i++) {
                const heart = document.createElement('span');
                heart.className = 'heart';
                livesDisplay.appendChild(heart);
            }
        }

        function endGame() {
            gameActive = false;
            gameOver.style.display = 'block';
            finalScore.textContent = `Очки: ${score}`;
            finalSteps.textContent = `Ступеней: ${steps}`;
            if (dog) {
                dog.element.remove();
                dog = null;
            }
        }

        function continueGame() {
            winScreen.style.display = 'none';
            gameActive = true;
            gameLoop();
        }

        function restartGame() {
            gameOver.style.display = 'none';
            winScreen.style.display = 'none';
            platforms.forEach(p => p.element.remove());
            bonuses.forEach(b => b.element.remove());
            catX = window.innerWidth / 2 - 20;
            catY = window.innerHeight - 140;
            startGame(selectedCat);
        }
    </script>
</body>
</html>

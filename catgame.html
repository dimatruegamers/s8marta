<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Игра с котиком</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@700&display=swap" rel="stylesheet">
    <style>
        html, body {
            margin: 0;
            padding: 0;
            height: 100%;
            overflow: hidden;
        }
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #ff9a9e, #fad0c4, #a1c4fd, #c2e9fb);
            font-family: 'Poppins', sans-serif;
            touch-action: none;
        }
        #game-wrapper {
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0;
            width: 100%;
            max-width: 600px;
            height: 100vh;
        }
        #game-container {
            position: relative;
            width: 600px;
            height: 600px;
            background: linear-gradient(135deg, #d4fc79, #96e6a1);
            border-radius: 30px;
            box-shadow: 0 15px 40px rgba(0,0,0,0.3);
            overflow: hidden;
            border: 6px solid rgba(255,255,255,0.9);
        }
        #cat {
            position: absolute;
            border-radius: 50%;
            transition: transform 0.5s ease-out;
            z-index: 10;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        .platform {
            position: absolute;
            background: linear-gradient(45deg, #ff6b6b, #ff8e53);
            border-radius: 8px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.2);
            z-index: 5;
            animation: bounce 2s infinite;
        }
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-5px); }
            60% { transform: translateY(-3px); }
        }
        .bonus {
            position: absolute;
            z-index: 15;
            transition: transform 0.3s ease;
        }
        .bonus:hover {
            transform: scale(1.2);
        }
        .heart-bonus {
            background: radial-gradient(#ff69b4, #ff1493);
            clip-path: polygon(50% 0%, 61% 35%, 98% 35%, 68% 57%, 79% 91%, 50% 70%, 21% 91%, 32% 57%, 2% 35%, 39% 35%);
            animation: float 1.5s infinite;
        }
        .food-bonus {
            background: #8b4513;
            border-radius: 5px;
            animation: float 1.5s infinite;
        }
        @keyframes float {
            0% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
            100% { transform: translateY(0); }
        }
        #dog {
            position: absolute;
            background: linear-gradient(45deg, #8b4513, #a0522d);
            border-radius: 4px;
            z-index: 10;
            box-shadow: 0 3px 8px rgba(0,0,0,0.2);
            animation: wag 0.5s infinite;
        }
        @keyframes wag {
            0% { transform: rotate(0deg); }
            25% { transform: rotate(5deg); }
            75% { transform: rotate(-5deg); }
            100% { transform: rotate(0deg); }
        }
        #score {
            position: absolute;
            top: 5%;
            left: 5%;
            color: #fff;
            font-weight: 700;
            padding: 1% 2%;
            border-radius: 12px;
            z-index: 20;
        }
        #steps {
            position: absolute;
            top: 15%;
            left: 5%;
            color: #fff;
            font-weight: 700;
            padding: 1% 2%;
            border-radius: 12px;
            z-index: 20;
        }
        #version {
            position: absolute;
            top: 2%;
            right: 5%;
            color: #fff;
            font-size: 12px;
            font-weight: 400;
            z-index: 20;
        }
        #lives {
            position: absolute;
            top: 5%;
            right: 5%;
            display: flex;
            gap: 4px;
            z-index: 20;
        }
        .heart {
            background: radial-gradient(circle, #ff69b4, #ff1493);
            clip-path: polygon(50% 0%, 61% 35%, 98% 35%, 68% 57%, 79% 91%, 50% 70%, 21% 91%, 32% 57%, 2% 35%, 39% 35%);
            box-shadow: 0 1px 3px rgba(0,0,0,0.2);
            animation: heartbeat 1s infinite;
        }
        @keyframes heartbeat {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        #menu, #game-over, #win-screen {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            color: #fff;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.5);
            background: rgba(255,255,255,0.2);
            padding: 20px;
            border-radius: 20px;
            backdrop-filter: blur(15px);
            z-index: 25;
            animation: pop 0.5s ease-in-out;
            width: 80%;
            max-width: 400px;
        }
        #menu button {
            margin: 10px;
            width: 100%;
        }
        @keyframes pop {
            0% { transform: translate(-50%, -50%) scale(0.8); opacity: 0; }
            100% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
        }
        #game-over {
            background: rgba(255, 105, 97, 0.9);
        }
        #win-screen {
            background: rgba(255, 182, 193, 0.9);
        }
        .controls {
            display: flex;
            justify-content: space-between;
            width: 600px;
            gap: 20px;
            padding: 10px;
            box-sizing: border-box;
            z-index: 1000;
            user-select: none;
        }
        .left-controls {
            display: flex;
            gap: 10px;
        }
        button {
            padding: 15px 30px;
            border: none;
            border-radius: 20px;
            background: linear-gradient(45deg, #ff6b6b, #ff8e53);
            color: #fff;
            font-family: 'Poppins', sans-serif;
            font-weight: 700;
            font-size: 20px;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
            z-index: 1001;
        }
        button:active {
            transform: scale(0.95);
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }
        button:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.3);
        }
        .blink { animation: blink 0.5s infinite; }
        @keyframes blink { 50% { opacity: 0; } }
        .score-pop {
            position: absolute;
            font-weight: 700;
            z-index: 20;
            animation: scoreFade 1s forwards;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }
        .heart-pop { color: #ff1493; }
        .food-pop { color: #8b4513; }
        @keyframes scoreFade {
            0% { opacity: 1; transform: translateY(0) scale(1); }
            100% { opacity: 0; transform: translateY(-15px) scale(1.2); }
        }

        @media only screen and (max-width: 600px) {
            body {
                display: block;
            }
            #game-wrapper {
                width: 100vw;
                height: 100vh;
            }
            #game-container {
                width: 100vw;
                height: calc(100vh - 120px); /* Увеличиваем место под кнопки */
                border-radius: 0;
                border: none;
                position: relative;
                top: 0;
                left: 0;
                transform: none;
            }
            #score {
                top: 2%;
            }
            #steps {
                top: 8%;
            }
            #version {
                top: 2%;
                right: 5%;
                font-size: 10px;
            }
            .controls {
                position: fixed;
                bottom: 10px; /* Поднимаем выше от низа */
                width: 100vw;
                height: 120px; /* Увеличиваем высоту под большие кнопки */
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 20px;
                background: rgba(255,255,255,0.1);
                backdrop-filter: blur(10px);
                z-index: 1000;
            }
            #menu, #game-over, #win-screen {
                width: 90%;
                max-width: 90vw;
                padding: 15px;
            }
            button {
                padding: 20px 40px; /* Увеличиваем размер в 2 раза */
                font-size: 32px; /* Увеличиваем текст в 2 раза */
            }
        }
    </style>
</head>
<body>
    <div id="game-wrapper">
        <div id="game-container">
            <div id="score">Очки: 0</div>
            <div id="steps">Ступень: 1</div>
            <div id="version">v1.0</div>
            <div id="lives"></div>
            <div id="cat"></div>
            <div id="menu">
                <h2>Выбери котика</h2>
                <p>Цель: Получи 1000 очков</p>
                <button id="pushok-btn">Пушок</button>
                <button id="fenya-btn">Феня</button>
            </div>
            <div id="game-over" style="display: none;">
                <h2>Игра окончена!</h2>
                <p id="final-score">Очки: 0</p>
                <p id="final-steps">Ступеней: 0</p>
                <button id="restart-btn">Играть заново</button>
            </div>
            <div id="win-screen" style="display: none;">
                <h2>Поздравляю с 8 Марта!</h2>
                <button id="continue-btn">Продолжить игру</button>
            </div>
        </div>
        <div class="controls">
            <div class="left-controls">
                <button id="left-btn">←</button>
                <button id="right-btn">→</button>
            </div>
            <button id="jump-btn">Прыжок</button>
        </div>
    </div>

    <script>
        const gameContainer = document.getElementById('game-container');
        const cat = document.getElementById('cat');
        const scoreDisplay = document.getElementById('score');
        const stepsDisplay = document.getElementById('steps');
        const livesDisplay = document.getElementById('lives');
        const menu = document.getElementById('menu');
        const gameOver = document.getElementById('game-over');
        const winScreen = document.getElementById('win-screen');
        const finalScore = document.getElementById('final-score');
        const finalSteps = document.getElementById('final-steps');

        // Элементы управления
        const pushokBtn = document.getElementById('pushok-btn');
        const fenyaBtn = document.getElementById('fenya-btn');
        const restartBtn = document.getElementById('restart-btn');
        const continueBtn = document.getElementById('continue-btn');
        const leftBtn = document.getElementById('left-btn');
        const rightBtn = document.getElementById('right-btn');
        const jumpBtn = document.getElementById('jump-btn');

        // Динамические размеры в зависимости от устройства
        const isMobile = window.innerWidth <= 600;
        const baseWidth = isMobile ? window.innerWidth : 600;
        const baseHeight = isMobile ? window.innerHeight - 120 : 600; // Увеличиваем место под кнопки на мобильных
        const scaleFactor = baseWidth / 600; // Масштаб относительно базового 600px

        // Применяем размеры
        gameContainer.style.width = `${baseWidth}px`;
        gameContainer.style.height = `${baseHeight}px`;

        let catX = baseWidth / 2 - 20 * scaleFactor, catY = 0, velocityY = 0, isJumping = false;
        let score = 0, lives = 1, platforms = [], bonuses = [], dog = null;
        let movingLeft = false, movingRight = false;
        let selectedCat = null, worldOffset = 0;
        let gameActive = true, visitedPlatforms = new Set();
        let platformCount = 0;
        let currentPlatform = null;
        let steps = 0;
        let hasWon = false;

        // Адаптация размеров элементов
        cat.style.width = `${40 * scaleFactor}px`;
        cat.style.height = `${40 * scaleFactor}px`;
        scoreDisplay.style.fontSize = `${28 * scaleFactor}px`;
        stepsDisplay.style.fontSize = `${22 * scaleFactor}px`;
        document.querySelectorAll('.heart').forEach(heart => {
            heart.style.width = `${25 * scaleFactor}px`;
            heart.style.height = `${25 * scaleFactor}px`;
        });
        document.querySelectorAll('.score-pop').forEach(pop => {
            pop.style.fontSize = `${24 * scaleFactor}px`;
        });

        // Обработчики событий для кнопок с поддержкой мультитач
        const touches = new Map();

        pushokBtn.addEventListener('click', () => startGame('pushok'));
        pushokBtn.addEventListener('touchstart', (e) => { e.preventDefault(); startGame('pushok'); });
        fenyaBtn.addEventListener('click', () => startGame('fenya'));
        fenyaBtn.addEventListener('touchstart', (e) => { e.preventDefault(); startGame('fenya'); });
        restartBtn.addEventListener('click', restartGame);
        restartBtn.addEventListener('touchstart', (e) => { e.preventDefault(); restartGame(); });
        continueBtn.addEventListener('click', continueGame);
        continueBtn.addEventListener('touchstart', (e) => { e.preventDefault(); continueGame(); });

        leftBtn.addEventListener('mousedown', () => moveLeft(true));
        leftBtn.addEventListener('mouseup', () => moveLeft(false));
        rightBtn.addEventListener('mousedown', () => moveRight(true));
        rightBtn.addEventListener('mouseup', () => moveRight(false));
        jumpBtn.addEventListener('mousedown', jump);

        leftBtn.addEventListener('touchstart', (e) => {
            e.preventDefault();
            for (let touch of e.changedTouches) {
                touches.set(touch.identifier, 'left');
                moveLeft(true);
            }
        });
        rightBtn.addEventListener('touchstart', (e) => {
            e.preventDefault();
            for (let touch of e.changedTouches) {
                touches.set(touch.identifier, 'right');
                moveRight(true);
            }
        });
        jumpBtn.addEventListener('touchstart', (e) => {
            e.preventDefault();
            for (let touch of e.changedTouches) {
                touches.set(touch.identifier, 'jump');
                jump();
            }
        });

        document.addEventListener('touchend', (e) => {
            e.preventDefault();
            for (let touch of e.changedTouches) {
                const action = touches.get(touch.identifier);
                if (action === 'left') moveLeft(false);
                if (action === 'right') moveRight(false);
                touches.delete(touch.identifier);
            }
        });

        document.addEventListener('touchcancel', (e) => {
            e.preventDefault();
            for (let touch of e.changedTouches) {
                const action = touches.get(touch.identifier);
                if (action === 'left') moveLeft(false);
                if (action === 'right') moveRight(false);
                touches.delete(touch.identifier);
            }
            movingLeft = false;
            movingRight = false;
        });

        function startGame(catType) {
            selectedCat = catType;
            cat.style.background = catType === 'pushok' ? 'radial-gradient(#fff, #ccc, #000)' : 'radial-gradient(#ff8c00, #ffa500)';
            menu.style.display = 'none';
            initGame();
            console.log(`Котик выбран: ${catType === 'pushok' ? 'Пушок' : 'Феня'}`);
            spawnDogRandomly();
        }

        function initGame() {
            platformCount = 0;
            visitedPlatforms.clear();
            platforms.forEach(p => p.element.remove());
            bonuses.forEach(b => b.element.remove());
            bonuses = [];
            platforms = [];
            generateInitialPlatforms();
            
            catX = platforms[0].x + platforms[0].width / 2 - 20 * scaleFactor;
            catY = platforms[0].y - 40 * scaleFactor;
            currentPlatform = platforms[0];
            cat.style.left = `${catX}px`;
            cat.style.top = `${catY}px`;
            worldOffset = 0;
            lives = 1;
            score = 0;
            steps = 0;
            gameActive = true;
            isJumping = false;
            velocityY = 0;
            movingLeft = false;
            movingRight = false;
            hasWon = false;
            updateScore();
            updateSteps();
            updateLives();
            gameLoop();
        }

        function generateInitialPlatforms() {
            for (let i = 0; i < 10; i++) {
                addNewPlatform();
            }
        }

        function addNewPlatform() {
            platformCount++;
            const maxJumpHeight = 150 * scaleFactor;
            const maxJumpDistance = 150 * scaleFactor;
            const minHorizontalGap = 100 * scaleFactor; // Минимум 100px в любую сторону
            const maxHorizontalGap = 240 * scaleFactor; // Максимум 240px
            const minVerticalGap = 234 * scaleFactor; // Увеличено в 2 раза
            const maxVerticalGap = 225 * scaleFactor;
            const direction = Math.random() < 0.5 ? -1 : 1;
            const x = platforms.length ? 
                Math.max(0, Math.min(baseWidth - 100 * scaleFactor, 
                    platforms[platforms.length - 1].x + direction * (Math.random() * (maxHorizontalGap - minHorizontalGap) + minHorizontalGap))) : 
                Math.floor(Math.random() * (baseWidth - 100 * scaleFactor)) + 50 * scaleFactor;
            const y = platforms.length ? 
                platforms[platforms.length - 1].y - (Math.random() * (maxVerticalGap - minVerticalGap) + minVerticalGap) : 
                baseHeight * 0.8 - 40 * scaleFactor; // Поднимаем первую платформу выше
            const isSmall = platformCount % 10 === 0 && Math.random() > 0.5;
            let width = isSmall ? 50 * scaleFactor : 100 * scaleFactor;
            if (platformCount > 40) {
                width = Math.max(10 * scaleFactor, 100 * scaleFactor - (platformCount - 40) * 2 * scaleFactor);
            }
            const platform = document.createElement('div');
            platform.className = `platform`;
            platform.style.left = `${x}px`;
            platform.style.top = `${y}px`;
            platform.style.width = `${width}px`;
            platform.style.height = `${15 * scaleFactor}px`;
            platform.dataset.count = platformCount;
            gameContainer.appendChild(platform);
            const platformObj = { 
                x, 
                y, 
                element: platform, 
                width: width, 
                id: Date.now() + platformCount, 
                count: platformCount,
                speed: platformCount >= 20 ? (Math.random() > 0.5 ? 2 * scaleFactor : -2 * scaleFactor) : 0
            };
            platforms.push(platformObj);

            if (platformCount % 20 === 0) {
                addBonus('heart', platformObj);
            } else if (platformCount % 8 === 0) {
                addBonus('food', platformObj);
            }
        }

        function addBonus(type, platform) {
            const bonus = {
                x: platform.x + platform.width / 2 - (type === 'food' ? 15 * scaleFactor : 10 * scaleFactor),
                y: platform.y - 25 * scaleFactor,
                type: type,
                element: document.createElement('div'),
                parentPlatform: platform
            };
            bonus.element.className = `bonus ${type === 'heart' ? 'heart-bonus' : 'food-bonus'}`;
            bonus.element.style.left = `${bonus.x}px`;
            bonus.element.style.top = `${bonus.y}px`;
            bonus.element.style.width = `${type === 'food' ? 30 * scaleFactor : 20 * scaleFactor}px`;
            bonus.element.style.height = `${type === 'food' ? 20 * scaleFactor : 20 * scaleFactor}px`;
            gameContainer.appendChild(bonus.element);
            bonuses.push(bonus);
            console.log(`Бонус появился: ${type === 'heart' ? 'сердце' : 'еда'} на платформе ${platformCount}, x: ${bonus.x}, y: ${bonus.y}`);
        }

        function gameLoop() {
            if (!gameActive) return;

            updatePlatforms();

            if (currentPlatform && currentPlatform.count >= 20 && !isJumping) {
                catX += currentPlatform.speed;
                catX = Math.max(0, Math.min(baseWidth - 40 * scaleFactor, catX));
            }

            if (movingLeft) catX -= 5 * scaleFactor;
            if (movingRight) catX += 5 * scaleFactor;

            catX = Math.max(0, Math.min(baseWidth - 40 * scaleFactor, catX));

            if (isJumping) {
                catY += velocityY;
                velocityY += 0.5 * scaleFactor;
            }

            const onPlatform = platforms.find(p => 
                catY + 40 * scaleFactor >= p.y && 
                catY + 40 * scaleFactor <= p.y + 15 * scaleFactor && 
                catX + 40 * scaleFactor > p.x && 
                catX < p.x + p.width
            );

            if (onPlatform && velocityY >= 0) {
                catY = onPlatform.y - 40 * scaleFactor;
                isJumping = false;
                velocityY = 0;
                currentPlatform = onPlatform;
            } else if (currentPlatform && !isJumping) {
                if (catX + 40 * scaleFactor <= currentPlatform.x || catX >= currentPlatform.x + currentPlatform.width) {
                    isJumping = true;
                }
            } else if (catY >= baseHeight) {
                if (lives > 0) {
                    lives--;
                    catY = currentPlatform ? currentPlatform.y - 40 * scaleFactor : platforms[0].y - 40 * scaleFactor;
                    catX = currentPlatform ? currentPlatform.x + currentPlatform.width / 2 - 20 * scaleFactor : platforms[0].x + platforms[0].width / 2 - 20 * scaleFactor;
                    isJumping = false;
                    velocityY = 0;
                    cat.style.transform = 'rotate(0deg)';
                    cat.classList.add('blink');
                    setTimeout(() => cat.classList.remove('blink'), 2000);
                    updateLives();
                    console.log(`Жизнь потеряна, возвращён на платформу на высоте ${catY + 40 * scaleFactor}`);
                    if (!currentPlatform) currentPlatform = platforms[0];
                    if (lives <= 0) return endGame();
                }
            }

            adjustWorld();
            cat.style.left = `${catX}px`;
            cat.style.top = `${catY}px`;
            checkCollisions();

            if (score >= 1000 && !hasWon) {
                gameActive = false;
                movingLeft = false;
                movingRight = false;
                winScreen.style.display = 'block';
                hasWon = true;
            }

            if (dog) updateDog();
            requestAnimationFrame(gameLoop);
        }

        function jump() {
            if (!gameActive || isJumping) return;
            const onPlatform = platforms.some(p => Math.abs(catY - (p.y - 40 * scaleFactor)) < 5 * scaleFactor);
            if (onPlatform) {
                isJumping = true;
                velocityY = -15 * scaleFactor;
                cat.style.transform = 'rotate(360deg)';
                console.log('Прыжок начался');
            }
        }

        function moveLeft(state) {
            if (!gameActive) return;
            movingLeft = state;
            console.log(`Движение влево: ${state ? 'начато' : 'остановлено'}`);
        }

        function moveRight(state) {
            if (!gameActive) return;
            movingRight = state;
            console.log(`Движение вправо: ${state ? 'начато' : 'остановлено'}`);
        }

        function updatePlatforms() {
            platforms.forEach(p => {
                if (p.count >= 20) {
                    p.x += p.speed;
                    if (p.x <= 0) p.speed = 2 * scaleFactor;
                    if (p.x >= baseWidth - p.width) p.speed = -2 * scaleFactor;
                    p.element.style.left = `${p.x}px`;
                }
            });

            bonuses.forEach(b => {
                if (b.parentPlatform.count >= 20) {
                    b.x = b.parentPlatform.x + b.parentPlatform.width / 2 - (b.type === 'food' ? 15 * scaleFactor : 10 * scaleFactor);
                    b.element.style.left = `${b.x}px`;
                }
            });
        }

        function adjustWorld() {
            if (catY < baseHeight / 2) {
                worldOffset = baseHeight / 2 - catY;
                catY = baseHeight / 2;
                platforms.forEach(p => {
                    p.y += worldOffset;
                    p.element.style.top = `${p.y}px`;
                });
                bonuses.forEach(b => {
                    b.y += worldOffset;
                    b.element.style.top = `${b.y}px`;
                });
                if (dog) {
                    dog.y += worldOffset;
                    dog.element.style.top = `${dog.y}px`;
                }
                if (platforms[0].y > baseHeight) {
                    platforms.shift().element.remove();
                    addNewPlatform();
                }
                worldOffset = 0;
            }
        }

        function checkCollisions() {
            platforms.forEach(p => {
                if (
                    catY + 40 * scaleFactor >= p.y && 
                    catY + 40 * scaleFactor <= p.y + 15 * scaleFactor && 
                    catX + 40 * scaleFactor > p.x && 
                    catX < p.x + p.width && 
                    velocityY >= 0
                ) {
                    catY = p.y - 40 * scaleFactor;
                    isJumping = false;
                    velocityY = 0;
                    cat.style.transform = 'rotate(0deg)';
                    if (!visitedPlatforms.has(p.id)) {
                        visitedPlatforms.add(p.id);
                        animateScore(score, score + 10);
                        steps++;
                        updateSteps();
                    }
                    currentPlatform = p;
                }
            });

            bonuses.forEach((b, index) => {
                const bonusWidth = b.type === 'food' ? 30 * scaleFactor : 20 * scaleFactor;
                if (
                    catX + 40 * scaleFactor > b.x && 
                    catX < b.x + bonusWidth && 
                    catY + 40 * scaleFactor > b.y && 
                    catY < b.y + (b.type === 'food' ? 20 * scaleFactor : 20 * scaleFactor)
                ) {
                    if (b.type === 'heart') {
                        if (lives < 5) {
                            lives++;
                            updateLives();
                            console.log(`Собрано сердце, жизней: ${lives}`);
                        } else {
                            animateScore(score, score + 100);
                            showScorePopup('+100', 'heart-pop');
                            console.log(`Собрано сердце, +100 очков, очки: ${score}`);
                        }
                    } else if (b.type === 'food') {
                        animateScore(score, score + 50);
                        showScorePopup('+50', 'food-pop');
                        console.log(`Собрана еда, +50 очков, очки: ${score}`);
                    }
                    b.element.remove();
                    bonuses.splice(index, 1);
                }
            });
        }

        function animateScore(start, end) {
            let current = start;
            const increment = (end - start) / 20;
            const duration = 500;
            const stepTime = duration / 20;

            function step() {
                current += increment;
                if ((increment > 0 && current >= end) || (increment < 0 && current <= end)) {
                    score = end;
                    scoreDisplay.textContent = `Очки: ${Math.round(score)}`;
                } else {
                    scoreDisplay.textContent = `Очки: ${Math.round(current)}`;
                    setTimeout(step, stepTime);
                }
            }

            step();
            score = end;
        }

        function showScorePopup(text, type) {
            const popup = document.createElement('div');
            popup.className = `score-pop ${type}`;
            popup.textContent = text;
            popup.style.left = `${catX + 20 * scaleFactor}px`;
            popup.style.top = `${catY - 20 * scaleFactor}px`;
            popup.style.fontSize = `${24 * scaleFactor}px`;
            gameContainer.appendChild(popup);
            setTimeout(() => popup.remove(), 1000);
        }

        function spawnDogRandomly() {
            if (!gameActive) return;
            setTimeout(() => {
                if (!dog && gameActive) spawnDog();
                spawnDogRandomly();
            }, Math.random() * 15000 + 15000);
        }

        function spawnDog() {
            dog = {
                x: -40 * scaleFactor,
                y: currentPlatform ? currentPlatform.y - 30 * scaleFactor : baseHeight - 40 * scaleFactor,
                element: document.createElement('div')
            };
            dog.element.id = 'dog';
            dog.element.style.left = `${dog.x}px`;
            dog.element.style.top = `${dog.y}px`;
            dog.element.style.width = `${40 * scaleFactor}px`;
            dog.element.style.height = `${30 * scaleFactor}px`;
            gameContainer.appendChild(dog.element);
        }

        function updateDog() {
            dog.x += 5 * scaleFactor;
            dog.element.style.left = `${dog.x}px`;
            if (dog.x > baseWidth) {
                dog.element.remove();
                dog = null;
            } else if (
                catX + 40 * scaleFactor > dog.x && 
                catX < dog.x + 40 * scaleFactor && 
                catY + 40 * scaleFactor > dog.y && 
                catY < dog.y + 30 * scaleFactor
            ) {
                lives = 0;
                updateLives();
                endGame();
            }
        }

        function updateScore() {
            scoreDisplay.textContent = `Очки: ${score}`;
            scoreDisplay.style.transform = 'scale(1.2)';
            setTimeout(() => scoreDisplay.style.transform = 'scale(1)', 200);
        }

        function updateSteps() {
            stepsDisplay.textContent = `Ступень: ${steps}`;
        }

        function updateLives() {
            livesDisplay.innerHTML = '';
            for (let i = 0; i < lives; i++) {
                const heart = document.createElement('span');
                heart.className = 'heart';
                heart.style.width = `${25 * scaleFactor}px`;
                heart.style.height = `${25 * scaleFactor}px`;
                livesDisplay.appendChild(heart);
            }
        }

        function endGame() {
            gameActive = false;
            movingLeft = false;
            movingRight = false;
            gameOver.style.display = 'block';
            finalScore.textContent = `Очки: ${score}`;
            finalSteps.textContent = `Ступеней: ${steps}`;
            if (dog) {
                dog.element.remove();
                dog = null;
            }
        }

        function continueGame() {
            winScreen.style.display = 'none';
            gameActive = true;
            movingLeft = false;
            movingRight = false;
            gameLoop();
        }

        function restartGame() {
            gameOver.style.display = 'none';
            winScreen.style.display = 'none';
            platforms.forEach(p => p.element.remove());
            bonuses.forEach(b => b.element.remove());
            catX = platforms[0] ? platforms[0].x + platforms[0].width / 2 - 20 * scaleFactor : baseWidth / 2 - 20 * scaleFactor;
            catY = platforms[0] ? platforms[0].y - 40 * scaleFactor : baseHeight - 40 * scaleFactor;
            movingLeft = false;
            movingRight = false;
            startGame(selectedCat);
        }

        document.addEventListener('keydown', (e) => {
            if (e.key === 'ArrowLeft') moveLeft(true);
            if (e.key === 'ArrowRight') moveRight(true);
            if (e.key === ' ') jump();
        });

        document.addEventListener('keyup', (e) => {
            if (e.key === 'ArrowLeft') moveLeft(false);
            if (e.key === 'ArrowRight') moveRight(false);
        });

        document.addEventListener('touchmove', (e) => e.preventDefault(), { passive: false });
    </script>
</body>
</html>
